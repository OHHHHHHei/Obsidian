# 定时器
## TIM定时器分类
### 基本定时器
预分频，自动装载值，自定义计数方向，自定义触发事件
单个脉冲输出
可以产生DMA请求定期搬运数据
### 通用定时器
基本定时器的全部功能
四个独立GPIO通道可以进行输入捕获，输出比较，PWM生成，编码器模式
### 高级定时器
通用定时器的全部功能
八个GPIO通道可以支持反向或互补的PWM输出
一个GPIO通道可以支持外部输入信号引入刹车重启等功能
## 预分频
对定时器输入频率进行分频，以得到合适的频率给定时器
## 计数模式
定时器有个计数器（counter，CNT），根据主频每产生一次脉冲，计数器改变1
向上计数 每次加一，直到最大，再重新开始轮回。向下计数，每次减一，从最大降到0，在重新开始循环。双向计数，先向上在向下，类似三角波
## 自动装载值（Auto Reload Register，ARR）
定时器的计数器只能在0到ARR之间变动。
上述技术模式的终点or起点值（取决于计数模式）
达到ARR或从ARR到0时，下一个定时器主频周期会产生溢出中断
## 关系
### 1. 定时器计数频率 ($CK_{CNT}$)

这是预分频器输出后，驱动计数器实际进行加/减操作的时钟频率。

$CK_{CNT} =(PSC+1)CK_{PSC}$​

---

### 2. 定时器中断周期 (Tinterrupt​)

这是计数器从一个周期的开始（例如 0）计数到结束（例如 ARR），并产生一次更新事件（通常触发中断）所需要的时间。

$T_{interrupt}​=CK_{CNT1}​×(ARR+1)$

将第一个公式代入第二个公式，得到最终的关系式：

$T_{interrupt}​=CK_{PSC}(PSC+1)×(ARR+1)​$

---

### 3. 定时器中断频率 ($F_{interrupt​}$)

这是中断周期的倒数，表示每秒钟产生多少次中断。

$F_{interrupt}​=T_{interrupt​1}​=(PSC+1)×(ARR+1)CK_{PSC}​$

# Delay函数
系统有一个滴答定时器SysTick，HAL库利用该定时器维护一个uint32变量uwTick
	定期增加，用于计时
只能在main函数中使用，不建议在中断中只用
	中断中使用需要考虑优先级问题日，如果优先级过低可能出现卡死
	即使没有卡死，也不符合中断回调函数精准优雅的编程逻辑
![[Pasted image 20250525221251.png]]

